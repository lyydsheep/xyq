## 最终产品需求文档 (PRD)：AI 绘本生成与社区软件（V1.0 - MVP）
### 1. 项目概述
+ **项目名称：** AI 绘本生成与社区
+ **核心目标：** 提供“一句话生成绘本”的核心功能，并搭建基础的绘本分享社区。
+ **核心竞争力：** 一句话智能生成完整绘本。
+ **技术栈：** Go 语言, Kratos 框架（微服务）, MySQL, Redis, **七牛云 OSS**, **WebSocket**。
+ **非功能目标：** 承受 **2000 QPS**，保障数据安全。

### 2. 核心用户与角色
| 角色 | 核心需求 | 权限 |
| :--- | :--- | :--- |
| **普通用户 (家长/学生)** | 快速生成绘本、浏览社区、点赞收藏。 | 基础绘本生成（消耗点数）、浏览/评论/分享、基础编辑。 |
| **付费用户** | 更多的创作点数。 | 在普通用户基础上，拥有额外增值服务。 |


### 3. 功能需求 (Functional Requirements)
#### 3.1 用户与认证 (User & Auth)
| ID | 功能名称 | 描述 | **批注/变动** |
| :--- | :--- | :--- | :--- |
| **F1.1** | 账户注册 | 用户只能通过 **邮箱验证码** 进行注册。 | 明确了注册方式 |
| **F1.2** | 账户登录 | 用户只能通过 **邮箱 + 密码** 形式登录。 | 明确了登录方式 |
| **F1.3** | 密码管理 | **暂不开发** 找回密码功能。 | 范围缩小 |
| **F1.4** | 权限与点数 | 每次 AI 生成和图片修改需消耗点数。用户点数不足时，禁止生成。 | 保持不变 |
| **F1.5** | 鉴权机制 | 使用 JWT 或类似机制进行安全认证。 | 保持不变 |


#### 3.2 绘本创作与管理 (Creation & Management)
| ID | 功能名称 | 描述 | **批注/变动** |
| :--- | :--- | :--- | :--- |
| **F2.1** | **一句话生成绘本** | 用户输入 Prompt，选择风格，提交后 **异步** 生成包含多页文本和图片的完整绘本。 | 保持不变 |
| **F2.2** | 任务状态推送 | 用户提交生成请求后，只通过 **WebSocket 发送最终完成通知**（不推送实时进度）。 | 明确通知机制 |
| **F2.3** | 单页图片修改 | 用户对已生成的绘本中**某一页**输入新的 Prompt，**重新生成图片**，但**不能改变该页文本内容**。此操作消耗点数。 | 保持不变 |
| **F2.4** | 绘本编辑 | 用户只能修改绘本的**标题**。**不能**调整页面顺序或删除页面。 | 明确编辑范围 |
| **F2.5** | 绘本保存 | 用户将生成的绘本保存为**草稿**（仅自己可见）。 | 保持不变 |
| **F2.6** | 绘本列表 | 查看自己创建和保存的所有绘本列表。 | 保持不变 |


#### 3.3 社区互动与分享 (Community & Sharing)
| ID | 功能名称 | 描述 |
| :--- | :--- | :--- |
| **F3.1** | 社区浏览 | 浏览其他用户分享的**已审核通过**的绘本。 |
| **F3.2** | 绘本分享 | 用户将自己的绘本从**草稿**提交，申请分享到社区。 |
| **F3.3** | 点赞/收藏 | 对社区绘本进行点赞和收藏。 |
| **F3.4** | 评论/回复 | 对社区绘本发表评论和进行回复。 |
| **F3.5** | 绘本搜索 | 支持根据标题、作者、关键词进行模糊搜索。 |


#### 3.4 内容安全与审核 (Audit & Security)
| ID | 功能名称 | 描述 |
| :--- | :--- | :--- |
| **F4.1** | 机器审核 | 所有提交到社区或生成的内容必须经过**机器审核**进行敏感信息过滤。 |
| **F4.2** | 举报机制 | 用户可以对社区中的不当内容进行举报。 |


### 4. 系统架构与技术规范 (Technical Specifications)
#### 4.1 微服务划分
| 服务名称 | 核心职责 | 存储 | 关键技术 |
| :--- | :--- | :--- | :--- |
| **User Service** | 用户认证、权限、**邮箱验证码管理**、点数管理。 | MySQL | JWT/gRPC |
| **Book Service** | 绘本元数据、页面数据 CRUD。 | MySQL, Redis (缓存) | RESTful API, gRPC |
| **AI Generator Service** | 接收和处理 AI 任务。 | 消息队列 | 消息队列, gRPC |
| **Notification Service** | WebSocket 连接管理、**任务完成消息推送**。 | - | WebSocket, gRPC |
| **Audit Service** | 内容安全审核（文本/图片）。 | - | 机器审核 API 调用 |
| **Storage Service** | 封装**七牛云 OSS** 操作。 | 七牛云 OSS | gRPC |


#### 4.2 数据存储
+ **结构化数据：** MySQL。
+ **缓存数据：** Redis (Session、热点绘本数据、用户点数、**邮箱验证码**)。
+ **非结构化数据：** **七牛云 OSS** (绘本图片、封面)。

#### 4.3 API 与文档
+ **API 风格：** RESTful API (对外)，gRPC (服务间通信)。
+ **文档工具：** 使用 **Kratos 框架自带的工具**生成 OpenAPI/Swagger 文档。

---

